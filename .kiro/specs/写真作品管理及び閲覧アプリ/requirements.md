# 要件定義書

## はじめに
写真作品管理及び閲覧アプリケーションは、写真家やフォトグラファーが作品を効率的に管理・閲覧するためのデスクトップアプリケーションです。Tauri + React + TypeScriptによるクロスプラットフォームアプリケーションとして実装され、ローカルファイルシステム上の写真作品を整理・分類・閲覧する機能を提供します。

## 要件

### 要件1: 写真ファイルの読み込みと一覧表示
**目的:** 写真家として、ローカルフォルダから写真ファイルを読み込み一覧表示したい。これにより作品全体を俯瞰できる。

#### 受入基準
1. ユーザーがフォルダを選択した時、システムは該当フォルダ内の画像ファイル（JPEG, PNG, WebP, HEIC等）を検出する
2. 検出された画像ファイルが存在する場合、システムはサムネイル形式でグリッドレイアウトに一覧表示する
3. サブフォルダが存在する場合、システムは再帰的にサブフォルダ内の画像も検出する
4. 画像ファイルが1000枚以上存在する場合、システムは仮想スクロールまたはページネーションを用いてパフォーマンスを維持する
5. システムは読み込み進捗をプログレスバーまたはローディングインジケーターで表示する

### 要件2: 画像の詳細表示とナビゲーション
**目的:** 写真家として、個別の写真を大きく表示し、前後の作品に移動したい。これにより作品を詳細に確認できる。

#### 受入基準
1. ユーザーがサムネイルをクリックした時、システムは該当画像を詳細表示モード（フルサイズまたはウィンドウフィット）で表示する
2. 詳細表示モード中にキーボード矢印キー（← →）またはナビゲーションボタンを操作した時、システムは前後の画像に切り替える
3. 詳細表示モード中にEscキーまたは閉じるボタンをクリックした時、システムは一覧表示に戻る
4. システムは画像のEXIF情報（撮影日時、カメラ機種、ISO、絞り、シャッタースピード等）を表示する
5. 高解像度画像の場合、システムはズームイン・ズームアウト機能を提供する

### 要件3: 写真のメタデータ管理
**目的:** 写真家として、各写真にタグ、レーティング、説明を追加したい。これにより作品を分類・検索しやすくする。

#### 受入基準
1. ユーザーが画像を選択してタグ追加操作をした時、システムは既存タグリストから選択またはタグ新規作成できるUIを表示する
2. ユーザーがレーティング（例: 1〜5つ星）を設定した時、システムは該当画像にレーティングを紐付けて保存する
3. ユーザーが説明文を入力した時、システムは該当画像に説明テキストを紐付けて保存する
4. メタデータはJSON形式でローカルストレージまたは専用データベース（SQLite等）に永続化される
5. システムは画像ファイルを移動・削除してもメタデータとの関連を維持する（ファイルパスまたはハッシュベース）

### 要件4: フィルタリングと検索機能
**目的:** 写真家として、タグ、レーティング、撮影日などで写真を絞り込みたい。これにより目的の作品を素早く見つけられる。

#### 受入基準
1. ユーザーがタグでフィルタリングした時、システムは該当タグを持つ画像のみを一覧表示する
2. ユーザーがレーティングでフィルタリングした時（例: 3つ星以上）、システムは該当レーティング以上の画像のみを表示する
3. ユーザーが撮影日範囲を指定した時、システムは該当期間内に撮影された画像のみを表示する
4. ユーザーがファイル名または説明文でキーワード検索した時、システムは部分一致する画像を表示する
5. システムは複数フィルタ条件の組み合わせ（AND条件）による絞り込みをサポートする

### 要件5: ソート機能
**目的:** 写真家として、撮影日時、ファイル名、レーティング順で作品を並び替えたい。これにより目的に応じた順序で閲覧できる。

#### 受入基準
1. ユーザーが撮影日時ソートを選択した時、システムはEXIF撮影日時順（昇順/降順）に画像を並び替える
2. ユーザーがファイル名ソートを選択した時、システムはアルファベット順（昇順/降順）に画像を並び替える
3. ユーザーがレーティングソートを選択した時、システムはレーティング順（高→低、低→高）に画像を並び替える
4. ユーザーが追加日時ソートを選択した時、システムはアプリへの追加（読み込み）日時順に画像を並び替える
5. システムは現在のソート設定を保持し、アプリ再起動後も復元する

### 要件6: お気に入り・コレクション機能
**目的:** 写真家として、特定の作品をお気に入りやコレクションにまとめたい。これにより作品セットを管理しやすくする。

#### 受入基準
1. ユーザーが画像をお気に入りに追加した時、システムはお気に入りフラグを該当画像に設定する
2. ユーザーがお気に入り一覧を表示した時、システムはお気に入りフラグのある画像のみを表示する
3. ユーザーがコレクション（アルバム）を作成した時、システムは新しいコレクションエントリをデータベースに追加する
4. ユーザーが画像を特定コレクションに追加した時、システムは該当コレクションと画像を関連付ける
5. システムは1つの画像が複数のコレクションに所属することを許可する

### 要件7: エクスポート機能
**目的:** 写真家として、選択した作品を特定のフォルダにエクスポートしたい。これにより納品や共有を容易にする。

#### 受入基準
1. ユーザーが画像を選択してエクスポートを実行した時、システムはエクスポート先フォルダ選択ダイアログを表示する
2. ユーザーがエクスポート先を指定した時、システムは選択画像をエクスポート先にコピーする
3. エクスポート時にリサイズオプションが選択されている場合、システムは指定サイズに画像をリサイズしてエクスポートする
4. エクスポート時にメタデータ保持オプションが選択されている場合、システムはEXIF情報を保持する
5. システムはエクスポート進捗を表示し、完了時に通知を表示する

### 要件8: データ永続化とバックアップ
**目的:** 写真家として、メタデータやコレクション情報を安全に保存したい。これによりデータ損失を防ぐ。

#### 受入基準
1. システムは起動時にローカルデータベース（SQLiteまたはJSON）からメタデータを読み込む
2. ユーザーがメタデータを変更した時、システムは自動的にデータベースに保存する
3. システムは設定でデータバックアップ機能を提供し、ユーザーが任意の場所にデータをエクスポートできる
4. システムはデータベースが破損した場合、エラーメッセージを表示し、バックアップからの復元オプションを提示する
5. システムは複数デバイス間での同期は行わず、ローカルストレージのみを使用する

### 要件9: UIレスポンシブネスとパフォーマンス
**目的:** 写真家として、大量の写真を扱う際もスムーズに操作したい。これにより快適な作業環境を実現する。

#### 受入基準
1. システムはサムネイル生成を非同期で行い、UIスレッドをブロックしない
2. 1000枚以上の画像を表示する場合、システムは仮想スクロールを用いてDOMノード数を最小化する
3. ユーザーがスクロールまたは画像切り替えを行った時、システムは100ms以内に応答する
4. 高解像度画像を表示する際、システムは段階的ローディング（プログレッシブJPEG対応）を実施する
5. システムはキャッシュ機構を用いて、一度表示した画像の再読み込みを避ける

### 要件10: クロスプラットフォーム対応
**目的:** 写真家として、Windows、macOS、Linux各環境で同じアプリを利用したい。これにより環境に依存せず作業できる。

#### 受入基準
1. システムはTauriを用いてWindows、macOS、Linux向けにビルドされる
2. 各OS固有のファイルダイアログが使用される（Tauriのdialog API使用）
3. システムは各OSのネイティブウィンドウフレームとメニューバーに対応する
4. ファイルパス処理は各OS間で互換性を持つ（パス区切り文字、ドライブレター等）
5. システムはOS固有のショートカットキー（Ctrl/Cmd + O等）をサポートする
